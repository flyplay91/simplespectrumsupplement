{%- layout none -%}{%- include 'LS_83195002989_global' -%}{%- if shop.metafields.langshop['searchProducts'] == "1" -%}{%- assign LS_strict_search = shop.metafields.langshop['searchStrict'] -%}{%- assign LS_search_terms = search.terms | downcase | replace: '&amp;', '&' | replace: '&quot;', '"' | replace: "&#39;", "'" -%}{%- assign LS_search_terms_handle = LS_search_terms | handleize | append: "-" | prepend: "-" -%}{%- capture LS_title_meta_key -%}{{ LS_83195002989_lang }}_title{%- endcapture -%}{%- capture LS_description_meta_key -%}{{ LS_83195002989_lang }}_body_html{%- endcapture -%}{%- assign LS_result_count = 0 -%}{%- if shop.metafields.langshop['searchMinProductPrice'] != blank -%}{%- assign searchMinProductPrice = shop.metafields.langshop['searchMinProductPrice'] | times: 100 -%}{%- endif -%}{%- if shop.metafields.langshop['searchMaxProductPrice'] != blank -%}{%- assign searchMaxProductPrice = shop.metafields.langshop['searchMaxProductPrice'] | times: 100 -%}{%- endif -%} { "status": "enabled", "items": [ {%- comment -%} Products search {%- endcomment -%}{%- paginate collections.all.products by 1000 -%}{%- for search_product in collections.all.products -%}{%- if search_product.metafields.langshop[LS_title_meta_key] -%}{%- assign loop_search_product_title = search_product.metafields.langshop[LS_title_meta_key] | downcase | strip_html -%}{%- else -%}{%- assign loop_search_product_title = search_product.title | downcase | strip_html -%}{%- endif -%}{%- if search_product.metafields.langshop[LS_description_meta_key] -%}{%- assign loop_search_product_description = search_product.metafields.langshop[LS_description_meta_key] | downcase | strip_html -%}{%- else -%}{%- assign loop_search_product_description = search_product.description | downcase | strip_html -%}{%- endif -%}{%- assign description_matched = false -%}{%- assign title_matched = false -%}{%- if shop.metafields.langshop['searchDisableDescription'] != "1" -%}{%- assign loop_search_product_description_handle = loop_search_product_description | handleize | append: "-" | prepend: "-" -%}{%- if LS_strict_search == "1" and loop_search_product_description_handle contains LS_search_terms_handle -%}{%- assign description_matched = true -%}{%- endif -%}{%- if LS_strict_search != "1" and loop_search_product_description contains LS_search_terms -%}{%- assign description_matched = true -%}{%- endif -%}{%- endif -%}{%- if shop.metafields.langshop['searchDisableTitle'] != "1" -%}{%- assign loop_search_product_title_handle = loop_search_product_title | handleize | append: "-" | prepend: "-" -%}{%- if LS_strict_search == "1" and loop_search_product_title_handle contains LS_search_terms_handle -%}{%- assign title_matched = true -%}{%- endif -%}{%- if LS_strict_search != "1" and loop_search_product_title contains LS_search_terms -%}{%- assign title_matched = true -%}{%- endif -%}{%- endif -%}{%- if title_matched or description_matched -%}{%- if shop.metafields.langshop['searchFeaturedImageOnly'] == "1" and search_product.featured_image == blank -%}{%- continue -%}{%- endif -%}{%- if shop.metafields.langshop['searchMaxProductPrice'] != blank and search_product.price > searchMaxProductPrice -%}{%- continue -%}{%- endif -%}{%- if shop.metafields.langshop['searchMinProductPrice'] != blank and search_product.price < searchMinProductPrice -%}{%- continue -%}{%- endif -%}{%- if LS_result_count > 0 -%},{%- endif -%} { "item": {{ search_product | json }}, "title": {{ loop_search_product_title | strip_newlines | json }}, "description": {{ loop_search_product_description | strip_newlines | json }} } {%- assign LS_result_count = LS_result_count | plus: 1 -%}{%- endif -%}{%- endfor -%}{%- endpaginate -%} ] }{%- else -%} { "status": "disabled" }{%- endif -%}